<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Player - Austin's Dragon Lair</title>
    <!-- Updated: 2025-01-10 with bot functionality -->
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body {
            background-image: url('images/header.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.2);
            z-index: -1;
        }

        @media screen and (max-width: 768px) {
            body {
                background-attachment: scroll;
            }
        }

        main {
            position: relative;
            z-index: 1;
        }

        .battle-container {
            max-width: 1400px;
            margin: 10px auto;
            padding: 10px;
        }

        .battle-header {
            text-align: center;
            margin-bottom: 15px;
        }

        .battle-header h1 {
            color: #FFD700;
            font-size: 32px;
            margin: 5px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .battle-header p {
            color: #E0E0E0;
            font-size: 16px;
            margin: 5px 0;
        }

        .battle-arena {
            display: flex;
            gap: 20px;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .battle-side {
            flex: 1;
            min-width: 300px;
        }

        .battle-side h2 {
            text-align: center;
            color: #FFD700;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .dragon-selector {
            width: 100%;
            padding: 8px;
            font-size: 14px;
            background-color: #1a1a1a;
            color: #FFFFFF;
            border: 2px solid #0080FF;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .dragon-selector:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .selected-dragon {
            background-color: #1a1a1a;
            border: 3px solid #0080FF;
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
        }

        @media screen and (max-width: 768px) {
            .selected-dragon {
                border-width: 2px;
                border-radius: 6px;
            }
        }

        .selected-dragon img {
            width: 100%;
            max-width: 250px;
            border: 2px solid #0080FF;
            border-radius: 8px;
            margin: 10px auto;
            display: block;
        }

        .selected-dragon h3 {
            color: #FFD700;
            font-size: 18px;
            text-align: center;
            margin: 10px 0 5px 0;
        }

        .selected-dragon .element {
            text-align: center;
            font-size: 14px;
            margin: 5px 0;
            font-weight: bold;
        }

        .selected-dragon h4 {
            color: #66B3FF;
            font-size: 16px;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .selected-dragon ol {
            color: #E0E0E0;
            line-height: 1.4;
            padding-left: 20px;
            font-size: 12px;
        }

        .selected-dragon ol li {
            margin-bottom: 5px;
        }

        .battle-button-container {
            text-align: center;
            margin: 15px 0;
            background-color: transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .battle-button {
            background-color: #FF4444 !important;
            color: #FFFFFF !important;
            font-size: 18px;
            font-weight: bold;
            padding: 12px 30px;
            border: 3px solid #FF6666 !important;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(255, 68, 68, 0.4);
            opacity: 1 !important;
        }

        .battle-button:hover {
            background-color: #DD2222;
            box-shadow: 0 6px 12px rgba(255, 68, 68, 0.6);
            transform: translateY(-2px);
        }

        .single-player-button {
            background-color: #44AA44 !important;
            color: #FFFFFF !important;
            font-size: 18px;
            font-weight: bold;
            padding: 12px 30px;
            border: 3px solid #66DD66 !important;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(68, 170, 68, 0.4);
            opacity: 1 !important;
            text-decoration: none;
            display: inline-block;
        }

        .single-player-button:hover {
            background-color: #338833 !important;
            box-shadow: 0 6px 12px rgba(68, 170, 68, 0.6);
            transform: translateY(-2px);
        }

        .single-player-button {
            background-color: #44AA44 !important;
            color: #FFFFFF !important;
            font-size: 18px;
            font-weight: bold;
            padding: 12px 30px;
            border: 3px solid #66DD66 !important;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(68, 170, 68, 0.4);
            text-decoration: none;
            display: inline-block;
            opacity: 1 !important;
        }

        .single-player-button:hover {
            background-color: #338833;
            box-shadow: 0 6px 12px rgba(68, 170, 68, 0.6);
            transform: translateY(-2px);
        }

        .battle-button:disabled {
            background-color: #666666;
            border-color: #888888;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .back-link-container {
            text-align: center;
            margin-top: 15px;
        }

        .back-link {
            color: #FFFFFF;
            font-size: 14px;
            text-decoration: none;
            background-color: #66AAFF;
            border: 2px solid #88CCFF;
            padding: 8px 20px;
            border-radius: 8px;
            display: inline-block;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(102, 170, 255, 0.4);
        }

        .back-link:hover {
            background-color: #4488FF;
            border-color: #66AAFF;
            box-shadow: 0 4px 8px rgba(102, 170, 255, 0.6);
            transform: translateY(-2px);
        }

        /* Element-specific colors for selected dragons */
        .selected-dragon.fire { border-color: #FF4444; }
        .selected-dragon.fire h3 { color: #FF6666; }
        .selected-dragon.fire .element { color: #FF6666; }
        .selected-dragon.fire img { border-color: #FF4444; }

        .selected-dragon.water { border-color: #4488FF; }
        .selected-dragon.water h3 { color: #66AAFF; }
        .selected-dragon.water .element { color: #66AAFF; }
        .selected-dragon.water img { border-color: #4488FF; }

        .selected-dragon.lightning { border-color: #FFDD00; }
        .selected-dragon.lightning h3 { color: #FFEE44; }
        .selected-dragon.lightning .element { color: #FFEE44; }
        .selected-dragon.lightning img { border-color: #FFDD00; }

        .selected-dragon.earth { border-color: #8B6F47; }
        .selected-dragon.earth h3 { color: #CCAA66; }
        .selected-dragon.earth .element { color: #CCAA66; }
        .selected-dragon.earth img { border-color: #8B6F47; }

        .selected-dragon.air { border-color: #88CCFF; }
        .selected-dragon.air h3 { color: #AAEEFF; }
        .selected-dragon.air .element { color: #AAEEFF; }
        .selected-dragon.air img { border-color: #88CCFF; }

        .selected-dragon.ice { border-color: #88EEFF; }
        .selected-dragon.ice h3 { color: #AAFFFF; }
        .selected-dragon.ice .element { color: #AAFFFF; }
        .selected-dragon.ice img { border-color: #88EEFF; }

        .selected-dragon.shadow { border-color: #8844AA; }
        .selected-dragon.shadow h3 { color: #BB88DD; }
        .selected-dragon.shadow .element { color: #BB88DD; }
        .selected-dragon.shadow img { border-color: #8844AA; }

        .selected-dragon.light { border-color: #FFD700; }
        .selected-dragon.light h3 { color: #FFEE88; }
        .selected-dragon.light .element { color: #FFEE88; }
        .selected-dragon.light img { border-color: #FFD700; }

        .selected-dragon.nature { border-color: #44AA44; }
        .selected-dragon.nature h3 { color: #66DD66; }
        .selected-dragon.nature .element { color: #66DD66; }
        .selected-dragon.nature img { border-color: #44AA44; }

        .selected-dragon.metal { border-color: #AAAAAA; }
        .selected-dragon.metal h3 { color: #DDDDDD; }
        .selected-dragon.metal .element { color: #DDDDDD; }
        .selected-dragon.metal img { border-color: #AAAAAA; }

        .selected-dragon.crystal { border-color: #BB66FF; }
        .selected-dragon.crystal h3 { color: #DD99FF; }
        .selected-dragon.crystal .element { color: #DD99FF; }
        .selected-dragon.crystal img { border-color: #BB66FF; }

        .selected-dragon.chaos { border-color: #FF44AA; }
        .selected-dragon.chaos h3 { color: #FF88DD; }
        .selected-dragon.chaos .element { color: #FF88DD; }
        .selected-dragon.chaos img { border-color: #FF44AA; }

        /* Battle View Styles */
        .selection-area {
            display: block;
        }

        .selection-area.hidden {
            display: none;
        }

        .battle-view {
            display: none;
        }

        .battle-view.active {
            display: block;
        }

        .battle-view-header {
            text-align: center;
            margin-bottom: 15px;
            position: relative;
        }

        .battle-view-header h1 {
            color: #FFD700;
            font-size: 28px;
            margin: 5px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .active-battle-arena {
            display: flex;
            gap: 20px;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .battle-dragon-card {
            flex: 1;
            min-width: 250px;
            background-color: #1a1a1a;
            border: 3px solid #0080FF;
            border-radius: 15px;
            padding: 10px;
            text-align: center;
        }

        @media screen and (max-width: 768px) {
            .battle-dragon-card {
                border-width: 2px;
                border-radius: 8px;
            }
        }

        /* Attack Summary Styles */
        .attack-summary-container {
            flex: 0 0 300px;
            background-color: #1a1a1a;
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 10px;
            text-align: center;
            display: flex;
            flex-direction: column;
        }

        @media screen and (max-width: 768px) {
            .attack-summary-container {
                border-width: 2px;
                border-radius: 8px;
            }
        }

        .attack-summary-title {
            color: #FFD700;
            font-size: 22px;
            margin: 0 0 10px 0;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .attack-summary {
            background-color: #0a0a0a;
            border: 2px solid #333333;
            border-radius: 10px;
            padding: 10px;
            min-height: 100px;
            color: #E0E0E0;
            font-size: 20px;
            line-height: 1.5;
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-weight: bold;
        }

        .attack-summary p {
            margin: 5px 0;
            padding: 5px;
        }

        .health-bar-container {
            margin-bottom: 10px;
        }

        .health-bar-label {
            color: #E0E0E0;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .health-bar {
            width: 100%;
            height: 20px;
            background-color: #333333;
            border: 2px solid #0080FF;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .health-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #44FF44 0%, #22DD22 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000000;
            font-weight: bold;
            font-size: 12px;
        }

        .health-bar-fill.low {
            background: linear-gradient(90deg, #FF4444 0%, #DD2222 100%);
            color: #FFFFFF;
        }

        .health-bar-fill.medium {
            background: linear-gradient(90deg, #FFAA44 0%, #DD8822 100%);
        }

        .shield-label {
            color: #8888FF;
            font-size: 12px;
            font-weight: bold;
            margin-top: 5px;
            text-align: center;
        }

        .shield-use-label {
            color: #AAAAFF;
            font-size: 12px;
            font-weight: bold;
            margin-top: 5px;
            text-align: center;
        }

        @media screen and (max-width: 768px) {
            .shield-label {
                font-size: 12px;
                margin-top: 3px;
            }
            .shield-use-label {
                font-size: 12px;
                margin-top: 3px;
            }
        }

        @media screen and (max-width: 480px) {
            .shield-label {
                font-size: 11px;
                margin-top: 2px;
            }
            .shield-use-label {
                font-size: 11px;
                margin-top: 2px;
            }
        }

        .battle-dragon-image {
            width: 100%;
            max-width: 200px;
            margin: 10px auto;
            display: block;
            border: 3px solid #0080FF;
            border-radius: 10px;
        }

        .battle-dragon-name {
            color: #FFD700;
            font-size: 18px;
            margin: 10px 0 5px 0;
            text-align: center;
        }

        .battle-dragon-element {
            color: #66B3FF;
            font-size: 14px;
            margin: 5px 0 10px 0;
            font-weight: bold;
        }

        .battle-powers-section {
            margin-top: 10px;
        }

        .battle-powers-section h3 {
            color: #FFD700;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .power-dropdown {
            width: 100%;
            padding: 8px;
            font-size: 12px;
            background-color: #2a2a2a;
            color: #FFFFFF;
            border: 2px solid #0080FF;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .power-dropdown:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .power-dropdown option {
            background-color: #1a1a1a;
            color: #FFFFFF;
        }

        .bot-power-text {
            width: 100%;
            padding: 8px;
            font-size: 12px;
            background-color: #2a2a2a;
            color: #FFFFFF;
            border: 2px solid #0080FF;
            border-radius: 8px;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .battle-actions {
            text-align: center;
            margin-top: 15px;
        }

        .new-battle-button {
            background-color: #66AAFF;
            color: #FFFFFF;
            font-size: 16px;
            font-weight: bold;
            padding: 10px 25px;
            border: 3px solid #88CCFF;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(102, 170, 255, 0.4);
            margin: 0 10px;
        }

        .new-battle-button:hover {
            background-color: #4488FF;
            box-shadow: 0 6px 12px rgba(102, 170, 255, 0.6);
            transform: translateY(-2px);
        }

        /* Element-specific colors for battle cards */
        .battle-dragon-card.fire { border-color: #FF4444; }
        .battle-dragon-card.fire .battle-dragon-name { color: #FF6666; }
        .battle-dragon-card.fire .battle-dragon-element { color: #FF6666; }
        .battle-dragon-card.fire .battle-dragon-image { border-color: #FF4444; }

        .battle-dragon-card.water { border-color: #4488FF; }
        .battle-dragon-card.water .battle-dragon-name { color: #66AAFF; }
        .battle-dragon-card.water .battle-dragon-element { color: #66AAFF; }
        .battle-dragon-card.water .battle-dragon-image { border-color: #4488FF; }

        .battle-dragon-card.lightning { border-color: #FFDD00; }
        .battle-dragon-card.lightning .battle-dragon-name { color: #FFEE44; }
        .battle-dragon-card.lightning .battle-dragon-element { color: #FFEE44; }
        .battle-dragon-card.lightning .battle-dragon-image { border-color: #FFDD00; }

        .battle-dragon-card.earth { border-color: #8B6F47; }
        .battle-dragon-card.earth .battle-dragon-name { color: #CCAA66; }
        .battle-dragon-card.earth .battle-dragon-element { color: #CCAA66; }
        .battle-dragon-card.earth .battle-dragon-image { border-color: #8B6F47; }

        .battle-dragon-card.air { border-color: #88CCFF; }
        .battle-dragon-card.air .battle-dragon-name { color: #AAEEFF; }
        .battle-dragon-card.air .battle-dragon-element { color: #AAEEFF; }
        .battle-dragon-card.air .battle-dragon-image { border-color: #88CCFF; }

        .battle-dragon-card.ice { border-color: #88EEFF; }
        .battle-dragon-card.ice .battle-dragon-name { color: #AAFFFF; }
        .battle-dragon-card.ice .battle-dragon-element { color: #AAFFFF; }
        .battle-dragon-card.ice .battle-dragon-image { border-color: #88EEFF; }

        .battle-dragon-card.shadow { border-color: #8844AA; }
        .battle-dragon-card.shadow .battle-dragon-name { color: #BB88DD; }
        .battle-dragon-card.shadow .battle-dragon-element { color: #BB88DD; }
        .battle-dragon-card.shadow .battle-dragon-image { border-color: #8844AA; }

        .battle-dragon-card.light { border-color: #FFD700; }
        .battle-dragon-card.light .battle-dragon-name { color: #FFEE88; }
        .battle-dragon-card.light .battle-dragon-element { color: #FFEE88; }
        .battle-dragon-card.light .battle-dragon-image { border-color: #FFD700; }

        .battle-dragon-card.nature { border-color: #44AA44; }
        .battle-dragon-card.nature .battle-dragon-name { color: #66DD66; }
        .battle-dragon-card.nature .battle-dragon-element { color: #66DD66; }
        .battle-dragon-card.nature .battle-dragon-image { border-color: #44AA44; }

        .battle-dragon-card.metal { border-color: #AAAAAA; }
        .battle-dragon-card.metal .battle-dragon-name { color: #DDDDDD; }
        .battle-dragon-card.metal .battle-dragon-element { color: #DDDDDD; }
        .battle-dragon-card.metal .battle-dragon-image { border-color: #AAAAAA; }

        .battle-dragon-card.crystal { border-color: #BB66FF; }
        .battle-dragon-card.crystal .battle-dragon-name { color: #DD99FF; }
        .battle-dragon-card.crystal .battle-dragon-element { color: #DD99FF; }
        .battle-dragon-card.crystal .battle-dragon-image { border-color: #BB66FF; }

        .battle-dragon-card.chaos { border-color: #FF44AA; }
        .battle-dragon-card.chaos .battle-dragon-name { color: #FF88DD; }
        .battle-dragon-card.chaos .battle-dragon-element { color: #FF88DD; }
        .battle-dragon-card.chaos .battle-dragon-image { border-color: #FF44AA; }

        /* Battle Log Styles */
        .battle-log-container {
            margin: 15px auto;
            max-width: 1200px;
            background-color: #1a1a1a;
            border: 3px solid #0080FF;
            border-radius: 15px;
            padding: 10px;
        }

        @media screen and (max-width: 768px) {
            .battle-log-container {
                margin: 3px auto;
                padding: 3px;
                border-width: 2px;
                border-radius: 8px;
            }
        }

        .battle-log-title {
            color: #FFD700;
            font-size: 18px;
            margin-bottom: 8px;
            text-align: center;
        }

        .battle-log {
            background-color: #0a0a0a;
            border: 2px solid #333333;
            border-radius: 10px;
            padding: 10px;
            max-height: 120px;
            overflow-y: auto;
            color: #E0E0E0;
            font-size: 12px;
            line-height: 1.4;
        }

        .battle-log p {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #0080FF;
            padding-left: 10px;
        }

        .battle-log .attack-message {
            color: #FF6666;
            font-weight: bold;
        }

        .battle-log .damage-message {
            color: #FFAA44;
        }

        .battle-log .result-message {
            color: #FFD700;
            font-weight: bold;
            font-size: 13px;
        }

        .battle-log .draw-message {
            color: #88CCFF;
            font-weight: bold;
            font-size: 13px;
        }

        /* Fight Button Styles */
        .fight-button-container {
            text-align: center;
            margin: 15px 0;
        }

        .fight-button {
            background-color: #FF4444 !important;
            color: #FFFFFF !important;
            font-size: 20px;
            font-weight: bold;
            padding: 12px 40px;
            border: 4px solid #FF6666 !important;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 12px rgba(255, 68, 68, 0.6);
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 1 !important;
        }

        .fight-button:hover:not(:disabled) {
            background-color: #DD2222;
            box-shadow: 0 8px 16px rgba(255, 68, 68, 0.8);
            transform: translateY(-3px) scale(1.05);
        }

        .fight-button:disabled {
            background-color: #666666;
            border-color: #888888;
            cursor: not-allowed;
            opacity: 0.5;
            transform: none;
        }

        /* Winner Screen Styles */
        .winner-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .winner-screen.hidden {
            display: none;
        }

        .winner-content {
            background-color: #1a1a1a;
            border: 5px solid #FFD700;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
        }

        .winner-title {
            color: #FFD700;
            font-size: 32px;
            margin: 0 0 10px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .winner-message {
            color: #E0E0E0;
            font-size: 18px;
            margin: 15px 0 20px 0;
            line-height: 1.4;
        }

        .new-game-button {
            background-color: #44AA44;
            color: #FFFFFF;
            font-size: 18px;
            font-weight: bold;
            padding: 12px 30px;
            border: 3px solid #66DD66;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(68, 170, 68, 0.6);
        }

        .new-game-button:hover {
            background-color: #338833;
            box-shadow: 0 6px 12px rgba(68, 170, 68, 0.8);
            transform: translateY(-2px);
        }

        /* HP Control Toggle */
        .hp-control-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
        }

        .hp-control-toggle label {
            color: #E0E0E0;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }

        .hp-control-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* HP Button */
        .hp-set-button {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: #FF4444;
            color: #FFFFFF;
            font-size: 18px;
            font-weight: bold;
            padding: 10px 20px;
            border: 3px solid #FF6666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(255, 68, 68, 0.4);
            z-index: 200;
        }

        .hp-set-button:hover {
            background-color: #DD2222;
            box-shadow: 0 6px 12px rgba(255, 68, 68, 0.6);
            transform: translateY(-2px);
        }

        .hp-set-button.hidden {
            display: none;
        }

        /* Mobile Responsive Styles */
        @media screen and (max-width: 768px) {
            /* Ensure minimum touch target sizes */
            button, select, .battle-button, .back-link {
                min-height: 32px;
                min-width: 32px;
            }
            .battle-container {
                padding: 2px;
                margin: 2px auto;
            }

            .battle-header {
                margin-bottom: 4px;
            }

            .battle-header h1 {
                font-size: 20px;
                margin: 2px 0;
            }

            .battle-header p {
                font-size: 14px;
                margin: 1px 0;
            }

            .battle-arena {
                flex-direction: column;
                gap: 4px;
                margin-bottom: 4px;
            }

            .battle-side {
                min-width: 100%;
            }

            .battle-side h2 {
                font-size: 16px;
                margin-bottom: 3px;
            }

            .dragon-selector {
                font-size: 14px;
                padding: 4px;
                margin-bottom: 3px;
            }

            .selected-dragon {
                padding: 3px;
                margin-top: 3px;
            }

            .selected-dragon img {
                max-width: 100px;
                margin: 3px auto;
            }

            .selected-dragon h3 {
                font-size: 14px;
                margin: 3px 0 2px 0;
            }

            .selected-dragon .element {
                font-size: 12px;
                margin: 2px 0;
            }

            .selected-dragon h4 {
                font-size: 13px;
                margin-top: 4px;
                margin-bottom: 2px;
            }

            .selected-dragon ol {
                font-size: 11px;
                line-height: 1.3;
                padding-left: 15px;
                margin: 2px 0;
            }

            .selected-dragon ol li {
                margin-bottom: 1px;
            }

            .battle-button-container {
                margin: 4px 0;
            }

            .battle-button {
                font-size: 14px;
                padding: 5px 12px;
                width: 100%;
                max-width: 200px;
            }

            .single-player-button {
                font-size: 14px;
                padding: 5px 12px;
                width: 100%;
                max-width: 200px;
            }

            .active-battle-arena {
                flex-direction: column;
                gap: 4px;
                margin-bottom: 4px;
            }

            .battle-dragon-card {
                min-width: 100%;
                padding: 3px;
            }

            .attack-summary-container {
                flex: 1;
                min-width: 100%;
                order: 2;
                padding: 3px;
            }

            .active-battle-arena .battle-dragon-card:first-of-type {
                order: 1;
            }

            .active-battle-arena .attack-summary-container {
                order: 2;
            }

            .active-battle-arena .battle-dragon-card:last-of-type {
                order: 3;
            }

            .health-bar-container {
                margin-bottom: 3px;
            }

            .health-bar-label {
                font-size: 12px;
                margin-bottom: 2px;
            }

            .health-bar {
                height: 12px;
            }

            .health-bar-fill {
                font-size: 11px;
            }

            .battle-dragon-image {
                max-width: 70px;
                margin: 3px auto;
            }

            .battle-dragon-name {
                font-size: 14px;
                margin: 3px 0 2px 0;
            }

            .battle-dragon-element {
                font-size: 12px;
                margin: 2px 0 3px 0;
            }

            .battle-powers-section {
                margin-top: 3px;
            }

            .battle-powers-section h3 {
                font-size: 13px;
                margin-bottom: 2px;
            }

            .power-dropdown {
                font-size: 12px;
                padding: 3px;
                margin-bottom: 2px;
            }

            .attack-summary-title {
                font-size: 18px;
                margin: 0 0 3px 0;
            }

            .attack-summary {
                font-size: 18px;
                min-height: 40px;
                padding: 3px;
                line-height: 1.3;
                font-weight: bold;
            }

            .attack-summary p {
                margin: 1px 0;
                padding: 1px;
            }

            .battle-log-container {
                padding: 2px;
                margin: 3px 1px;
                border-width: 2px;
            }

            .battle-log-title {
                font-size: 13px;
                margin-bottom: 2px;
            }

            .battle-log {
                font-size: 11px;
                max-height: 50px;
                padding: 3px;
                line-height: 1.3;
            }

            .battle-log p {
                margin: 2px 0;
                padding: 2px;
                padding-left: 6px;
                font-size: 11px;
            }

            .fight-button-container {
                margin: 4px 0;
            }

            .fight-button {
                font-size: 16px;
                padding: 5px 15px;
                width: 100%;
                max-width: 200px;
                letter-spacing: 0.3px;
            }

            .battle-view-header {
                margin-bottom: 4px;
                padding-top: 30px;
            }

            .battle-view-header h1 {
                font-size: 18px;
                margin: 2px 0;
            }

            .hp-control-toggle {
                top: 2px;
                right: 2px;
                flex-direction: column;
                gap: 2px;
                font-size: 11px;
            }

            .hp-control-toggle label {
                font-size: 11px;
            }

            .hp-control-toggle input[type="checkbox"] {
                width: 12px;
                height: 12px;
            }

            .hp-set-button {
                top: 2px;
                left: 2px;
                font-size: 9px;
                padding: 4px 8px;
            }

            .new-battle-button {
                font-size: 13px;
                padding: 4px 10px;
                width: 100%;
                max-width: 120px;
                margin: 2px 0;
            }

            .back-link-container {
                margin-top: 4px;
            }

            .back-link {
                font-size: 12px;
                padding: 4px 10px;
                display: block;
                margin: 2px auto;
                width: fit-content;
            }

            .battle-actions {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 3px;
                margin-top: 4px;
            }

            .winner-content {
                padding: 10px;
                max-width: 90%;
                margin: 0 10px;
            }

            .winner-title {
                font-size: 20px;
                margin: 0 0 5px 0;
            }

            .winner-message {
                font-size: 14px;
                margin: 6px 0 10px 0;
            }

            .new-game-button {
                font-size: 14px;
                padding: 6px 15px;
                width: 100%;
                max-width: 150px;
            }
        }

        @media screen and (max-width: 480px) {
            .battle-container {
                padding: 1px;
                margin: 1px auto;
            }

            .battle-header h1 {
                font-size: 18px;
                margin: 1px 0;
            }

            .battle-header p {
                font-size: 13px;
                margin: 1px 0;
            }

            .battle-button {
                font-size: 13px;
                padding: 4px 10px;
                max-width: 150px;
            }

            .fight-button {
                font-size: 15px;
                padding: 4px 12px;
                max-width: 150px;
            }

            .battle-dragon-image {
                max-width: 50px;
            }

            .attack-summary-title {
                font-size: 16px;
                margin: 0 0 3px 0;
            }

            .attack-summary {
                font-size: 16px;
                min-height: 30px;
                padding: 2px;
                font-weight: bold;
            }

            .battle-log {
                font-size: 10px;
                max-height: 40px;
                padding: 2px;
            }

            .battle-log p {
                font-size: 10px;
                margin: 1px 0;
                padding: 1px;
                padding-left: 4px;
            }

            .selected-dragon {
                padding: 2px;
            }

            .selected-dragon img {
                max-width: 70px;
            }

            .selected-dragon h3 {
                font-size: 13px;
            }

            .selected-dragon h4 {
                font-size: 12px;
            }

            .selected-dragon ol {
                font-size: 11px;
            }

            .battle-dragon-name {
                font-size: 13px;
            }

            .battle-dragon-element {
                font-size: 11px;
            }

            .health-bar-label {
                font-size: 11px;
            }

            .health-bar {
                height: 10px;
            }

            .health-bar-fill {
                font-size: 10px;
            }

            .power-dropdown {
                font-size: 11px;
                padding: 2px;
            }

            .battle-view-header {
                padding-top: 25px;
            }

            .battle-view-header h1 {
                font-size: 16px;
            }

            .winner-title {
                font-size: 18px;
            }

            .winner-message {
                font-size: 13px;
            }

            .new-game-button {
                font-size: 13px;
                padding: 5px 12px;
            }

            .hp-control-toggle {
                font-size: 10px;
            }

            .hp-control-toggle label {
                font-size: 10px;
            }

            .hp-set-button {
                font-size: 12px;
                padding: 3px 6px;
            }
        }
    </style>
</head>
<body>
    <!-- Main Content Section -->
    <main>
        <div class="battle-container">
            <!-- Selection Area -->
            <div id="selection-area" class="selection-area">
                <div class="battle-header">
                    <h1>SINGLE PLAYER</h1>
                    <p>Choose your dragon to battle against a bot!</p>
                </div>

                <div class="battle-arena">
                    <!-- Player Dragon Selection -->
                    <div class="battle-side">
                        <h2>Your Dragon</h2>
                        <select id="dragon1-select" class="dragon-selector">
                            <option value="">-- Choose Your Dragon --</option>
                            <option value="breezeflight">Breezeflight the Windwhisper</option>
                            <option value="chaosflare">Chaosflare the Stormbringer</option>
                            <option value="crystalwing">Crystalwing the Prismkeeper</option>
                            <option value="earthheart">Earthheart the Stonekeeper</option>
                            <option value="flamethorn">Flamethorn the Firebringer</option>
                            <option value="frostbite">Frostbite the Iceweaver</option>
                            <option value="radiant">Radiant the Sunbeam</option>
                            <option value="stormwing">Stormwing the Skybreaker</option>
                            <option value="metalbeak">Metalbeak the Forgeguard</option>
                            <option value="vineclaw">Vineclaw the Lifegiver</option>
                            <option value="shadowmaw">Shadowmaw the Nightstalker</option>
                            <option value="aquaris">Aquaris the Depthcaller</option>
                        </select>
                        <div id="dragon1-display"></div>
                    </div>
                </div>

                <div class="battle-button-container">
                    <button id="battle-button" class="battle-button" disabled>Start Single Player</button>
                </div>

                <div class="back-link-container">
                    <a href="index.html" class="back-link">← Back to Dragon Lair</a>
                </div>
            </div>

            <!-- HP Control Button (shown when toggle is on, positioned in upper left) -->
            <button id="hp-set-button" class="hp-set-button hidden">HP: 5</button>

            <!-- Battle View (hidden initially) -->
            <div id="battle-view" class="battle-view">
                <div class="battle-view-header">
                    <h1>BATTLE IN PROGRESS</h1>
                    <!-- HP Control Toggle -->
                    <div class="hp-control-toggle">
                        <input type="checkbox" id="hp-control-toggle" />
                        <label for="hp-control-toggle">Enable HP Control</label>
                    </div>
                </div>

                <div class="active-battle-arena">
                    <!-- Dragon 1 Battle Card -->
                    <div id="battle-dragon1-card" class="battle-dragon-card">
                        <div class="health-bar-container">
                            <div class="health-bar-label">Hitpoints: <span id="hp1-display">10</span>/10</div>
                            <div class="health-bar">
                                <div id="hp1-bar" class="health-bar-fill" style="width: 100%;">10 HP</div>
                            </div>
                            <div class="shield-label" id="shield1-label" style="display: none;">Shield: <span id="shield1-display">0</span></div>
                            <div class="shield-use-label">Shield Uses: <span id="shield1-uses-display">0</span>/3</div>
                        </div>
                        <img id="battle-dragon1-image" class="battle-dragon-image" src="" alt="" />
                        <h2 id="battle-dragon1-name" class="battle-dragon-name"></h2>
                        <p id="battle-dragon1-element" class="battle-dragon-element"></p>
                        <div class="battle-powers-section">
                            <h3>Powers</h3>
                            <select id="battle-dragon1-powers" class="power-dropdown">
                                <option value="">-- Select a Power --</option>
                            </select>
                        </div>
                    </div>

                    <!-- Attack Summary Box -->
                    <div id="attack-summary-container" class="attack-summary-container">
                        <h3 class="attack-summary-title">Attack Summary</h3>
                        <div id="attack-summary" class="attack-summary">
                            <p style="color: #88CCFF; font-weight: bold;">Select powers and click FIGHT!</p>
                        </div>
                    </div>

                    <!-- Dragon 2 Battle Card -->
                    <div id="battle-dragon2-card" class="battle-dragon-card">
                        <div class="health-bar-container">
                            <div class="health-bar-label">Hitpoints: <span id="hp2-display">10</span>/10</div>
                            <div class="health-bar">
                                <div id="hp2-bar" class="health-bar-fill" style="width: 100%;">10 HP</div>
                            </div>
                            <div class="shield-label" id="shield2-label" style="display: none;">Shield: <span id="shield2-display">0</span></div>
                            <div class="shield-use-label">Shield Uses: <span id="shield2-uses-display">0</span>/3</div>
                        </div>
                        <img id="battle-dragon2-image" class="battle-dragon-image" src="" alt="" />
                        <h2 id="battle-dragon2-name" class="battle-dragon-name"></h2>
                        <p id="battle-dragon2-element" class="battle-dragon-element"></p>
                        <div class="battle-powers-section">
                            <h3>Power (Bot)</h3>
                            <div id="battle-dragon2-powers" class="bot-power-text">-- Bot will select power --</div>
                        </div>
                    </div>
                </div>

                <!-- Battle Log -->
                <div id="battle-log-container" class="battle-log-container">
                    <h3 class="battle-log-title">Battle Log</h3>
                    <div id="battle-log" class="battle-log"></div>
                </div>

                <!-- Fight Button -->
                <div class="fight-button-container">
                    <button id="fight-button" class="fight-button" disabled>FIGHT!!!!</button>
                </div>

                <!-- Winner Screen (hidden initially) -->
                <div id="winner-screen" class="winner-screen hidden">
                    <div class="winner-content">
                        <h1 id="winner-title" class="winner-title"></h1>
                        <p id="winner-message" class="winner-message"></p>
                        <button id="new-game-button" class="new-game-button">Start New Game</button>
                    </div>
                </div>

                <div class="battle-actions">
                    <button id="new-battle-button" class="new-battle-button">New Battle</button>
                    <a href="index.html" class="back-link">← Back to Dragon Lair</a>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Dragon data with all information
        const dragonData = {
            breezeflight: {
                name: "Breezeflight the Windwhisper",
                element: "Air",
                image: "images/breezeflight.jpg",
                powers: [
                    { name: "Wind Messenger", description: "Breezeflight can create air currents that carry sounds and messages throughout the entire lair, making him the perfect messenger between dragons and across great distances." },
                    { name: "Gust Speed", description: "By riding and manipulating air currents, Breezeflight can achieve incredible speeds, becoming a silver-white blur that moves faster than any other dragon." },
                    { name: "Whisper Network", description: "He can hear and understand the language of the winds, allowing him to listen to conversations carried on air currents from miles away." },
                    { name: "Gentle Levitation", description: "Breezeflight can create powerful upward air currents that allow him to lift objects, creatures, or even other dragons without causing harm, using the gentlest of breezes." },
                    { name: "Pollination Wind", description: "By controlling precise air currents, he can spread seeds and pollen across vast distances, helping Vineclaw's gardens flourish throughout the entire lair." },
                    { name: "Refreshing Breeze (Healing)", description: "Breezeflight can channel pure, revitalizing air currents that flow through his body, healing wounds and restoring his strength with the gentle touch of the wind.", isHealing: true },
                    { name: "Air Barrier (Shield)", description: "Breezeflight can create a protective barrier of compressed air currents that deflects attacks and shields him from incoming damage.", isShield: true },
                    { name: "Hurricane Revival (Instant Heal)", description: "Breezeflight can summon a massive hurricane of pure life-giving air that instantly restores all of his health in a single, powerful gust that completely heals all wounds.", isInstantHeal: true }
                ]
            },
            chaosflare: {
                name: "Chaosflare the Stormbringer",
                element: "Chaos",
                image: "images/chaosflare.jpg",
                powers: [
                    { name: "Elemental Fusion", description: "Chaosflare can mix elements together, creating new hybrid powers like frozen fire, electric water, or shadowy light that no other dragon can master." },
                    { name: "Reality Distortion", description: "His very presence bends reality slightly, causing unpredictable color shifts in his scales and making nearby objects behave in strange ways." },
                    { name: "Chaos Blast", description: "He can unleash bursts of pure chaos energy that scramble elemental powers, temporarily disrupting other dragons' abilities in unexpected ways." },
                    { name: "Pattern Randomization", description: "Chaosflare can create beautiful, unpredictable patterns of light, energy, and color that defy logic and mesmerize those who watch them." },
                    { name: "Unpredictable Teleportation", description: "Through chaotic space manipulation, he can instantly appear anywhere in the lair, though the destination is often slightly different from where he intended." },
                    { name: "Chaotic Regeneration (Healing)", description: "Chaosflare can channel the unpredictable nature of chaos itself to twist reality around his wounds, causing them to heal in wild and unexpected ways that restore his vitality.", isHealing: true },
                    { name: "Chaos Barrier (Shield)", description: "Chaosflare can create a swirling barrier of chaotic energy that warps and deflects incoming attacks, making him unpredictable and hard to hit.", isShield: true },
                    { name: "Reality Rewrite (Instant Heal)", description: "Chaosflare can completely rewrite reality itself, instantly erasing all wounds and damage from existence, restoring himself to perfect health in an instant.", isInstantHeal: true }
                ]
            },
            crystalwing: {
                name: "Crystalwing the Prismkeeper",
                element: "Crystal",
                image: "images/crystalwing.jpg",
                powers: [
                    { name: "Memory Crystals", description: "Crystalwing can store memories and visions inside crystals she creates, allowing the lair to have a visual history of everything that happens." },
                    { name: "Prism Light Refraction", description: "Her transparent scales refract light into beautiful rainbow displays, creating stunning visual effects that can illuminate entire chambers." },
                    { name: "Crystal Growth", description: "She can grow crystals from any surface, creating structures, tools, or decorations that are both beautiful and functional." },
                    { name: "Vision Projection", description: "By touching one of her memory crystals, Crystalwing can project stored memories as visible images, allowing others to see past events." },
                    { name: "Prismatic Shield", description: "She can create crystal barriers that refract attacks, splitting incoming energy or projectiles into harmless fragments." },
                    { name: "Crystalline Restoration (Healing)", description: "Crystalwing can form healing crystals that grow from her wounds, sealing them with pure crystal that restores her vitality and makes her scales shine even brighter.", isHealing: true },
                    { name: "Crystal Barrier (Shield)", description: "Crystalwing can grow a protective crystal barrier around herself that refracts and reflects incoming attacks, shielding her with brilliant prismatic defenses.", isShield: true },
                    { name: "Perfect Prism Renewal (Instant Heal)", description: "Crystalwing can create a perfect, flawless crystal that instantly refracts pure healing energy through every part of her body, completely restoring her health in a brilliant flash of light.", isInstantHeal: true }
                ]
            },
            earthheart: {
                name: "Earthheart the Stonekeeper",
                element: "Earth",
                image: "images/earthheart.jpg",
                powers: [
                    { name: "Stone Shaping", description: "Earthheart can shape stone with his claws, creating new tunnels and rooms in the lair by simply touching the walls, reshaping the very foundation of the lair." },
                    { name: "Moss Armor", description: "His scales naturally grow moss and lichen that provide extra protection and allow him to blend seamlessly with stone surfaces." },
                    { name: "Ground Tremor", description: "By stomping his powerful feet, Earthheart can create controlled tremors that reshape terrain or serve as a warning to other dragons." },
                    { name: "Earthen Shield", description: "He can raise walls of stone from the ground to protect himself and others, creating instant fortifications when needed." },
                    { name: "Mineral Sensing", description: "Earthheart can sense valuable minerals and ores deep underground, helping Metalbeak locate the finest materials for forging." },
                    { name: "Earthen Regeneration (Healing)", description: "Earthheart can draw strength from the very earth beneath him, causing his stone-like scales to repair themselves and his wounds to seal with rich, healing soil and minerals.", isHealing: true },
                    { name: "Stone Barrier (Shield)", description: "Earthheart can raise an impenetrable wall of solid stone around himself, creating a protective barrier that absorbs and blocks incoming damage.", isShield: true },
                    { name: "Bedrock Restoration (Instant Heal)", description: "Earthheart can merge completely with the ancient bedrock itself, drawing infinite strength from the deepest earth to instantly restore all of his health to perfect condition.", isInstantHeal: true }
                ]
            },
            flamethorn: {
                name: "Flamethorn the Firebringer",
                element: "Fire",
                image: "images/flamethorn.jpg",
                powers: [
                    { name: "Eternal Flame", description: "Flamethorn can breathe fire that never burns out, creating eternal torches that light up the darkest corners of the lair without ever needing refueling." },
                    { name: "Ember Creation", description: "His wings create sparks and embers with every beat, leaving trails of glowing embers that can ignite fires or create beautiful light displays." },
                    { name: "Heat Manipulation", description: "Flamethorn can control the intensity of his flames, from gentle warmth that comforts to scorching blasts that can melt the hardest metals." },
                    { name: "Forge Fire", description: "He can produce specialized flames perfect for Metalbeak's forge work, creating fires that burn at precise temperatures for metalworking." },
                    { name: "Fire Shield", description: "Flamethorn can surround himself or others with protective walls of flame that burn enemies while keeping allies safe from the heat." },
                    { name: "Fiery Restoration (Healing)", description: "Flamethorn can channel his eternal flames inward, using their purifying heat to cauterize wounds and reignite his inner fire, restoring his strength and vitality.", isHealing: true },
                    { name: "Blazing Barrier (Shield)", description: "Flamethorn can create a protective wall of eternal flames that burns away incoming attacks, shielding him with unquenchable fire that destroys anything that touches it.", isShield: true },
                    { name: "Phoenix Rebirth (Instant Heal)", description: "Flamethorn can channel the legendary power of the phoenix, completely immolating himself in eternal flames that instantly burn away all wounds and restore him to perfect health.", isInstantHeal: true }
                ]
            },
            frostbite: {
                name: "Frostbite the Iceweaver",
                element: "Ice",
                image: "images/frostbite.jpg",
                powers: [
                    { name: "Time Freeze", description: "Frostbite can freeze time in small areas, creating frozen moments that she can examine and then release, perfect for protecting treasures or preventing disasters." },
                    { name: "Ice Sculpture", description: "Her breath creates beautiful ice sculptures that capture moments in time, forming intricate frozen artworks that never melt." },
                    { name: "Permafrost Breath", description: "Frostbite can breathe ice so cold that it creates permanent ice formations, even in the presence of heat, protecting important areas." },
                    { name: "Crystalline Shield", description: "She can create walls of ice that are harder than diamond, providing protection that reflects and refracts attacks." },
                    { name: "Flash Freeze", description: "Frostbite can instantly freeze water, objects, or even small areas of space, preserving them in perfect condition for eternity." },
                    { name: "Icy Rejuvenation (Healing)", description: "Frostbite can freeze her wounds solid, preventing further damage while her pure ice scales slowly regenerate and restore her health with the power of eternal winter.", isHealing: true },
                    { name: "Glacial Barrier (Shield)", description: "Frostbite can create an unbreakable wall of permafrost ice around herself, forming a protective barrier of eternal cold that freezes and shatters incoming attacks.", isShield: true },
                    { name: "Absolute Zero Recovery (Instant Heal)", description: "Frostbite can freeze time itself around her wounds, instantly preserving them in perfect ice that melts away to reveal completely healed, unblemished scales and full health.", isInstantHeal: true }
                ]
            },
            radiant: {
                name: "Radiant the Sunbeam",
                element: "Light",
                image: "images/radiant.jpg",
                powers: [
                    { name: "Solid Light Constructs", description: "Radiant can create solid light constructs - bridges, stairs, and walls made entirely of pure light that last for hours, building structures of pure radiance." },
                    { name: "Prismatic Wings", description: "Her wings create beautiful rainbow displays when they catch the light, producing prismatic effects that can dazzle and inspire." },
                    { name: "Guiding Light", description: "Radiant can create beams of light that guide others through darkness, leading them safely to their destination." },
                    { name: "Solar Growth", description: "She can focus her light to accelerate plant growth, helping Vineclaw's gardens flourish with enhanced photosynthesis." },
                    { name: "Light Healing", description: "Radiant's warm, golden light has gentle healing properties that can soothe wounds and restore energy to those who bask in her radiance." },
                    { name: "Solar Restoration (Healing)", description: "Radiant can channel pure sunlight into her body, filling every wound with warm, healing radiance that restores her health and makes her golden scales shine with renewed brilliance.", isHealing: true },
                    { name: "Radiant Barrier (Shield)", description: "Radiant can create a barrier of solid golden light that surrounds her, forming a protective shield of pure radiance that blinds and deflects incoming attacks.", isShield: true },
                    { name: "Divine Light Revival (Instant Heal)", description: "Radiant can channel the full power of the sun itself, becoming a beacon of pure divine light that instantly fills every wound with absolute radiance, completely restoring her health in a blinding flash.", isInstantHeal: true }
                ]
            },
            stormwing: {
                name: "Stormwing the Skybreaker",
                element: "Lightning",
                image: "images/stormwing.jpg",
                powers: [
                    { name: "Electrical Grid", description: "Stormwing can channel lightning through his wings to power crystals throughout the lair, creating a natural electrical grid that provides energy to all." },
                    { name: "Lightning Strike", description: "He can call down bolts of lightning from the sky, directing them with precision to strike targets from great distances." },
                    { name: "Thunder Clap", description: "Stormwing can create thunderous booms that shake the very foundations of the lair, serving as warnings or displays of power." },
                    { name: "Electric Conductivity", description: "His scales can store and channel electricity, allowing him to power devices or create electrical weapons on demand." },
                    { name: "Storm Summoning", description: "Stormwing can create localized storms around himself, generating powerful winds, lightning, and thunder that protect and defend." },
                    { name: "Electric Restoration (Healing)", description: "Stormwing can channel lightning through his own body, using the electrical energy to stimulate his cells and regenerate damaged tissue, restoring his health with the power of the storm.", isHealing: true },
                    { name: "Lightning Barrier (Shield)", description: "Stormwing can create a crackling barrier of electrical energy around himself, forming a protective shield of lightning that zaps and redirects incoming attacks.", isShield: true },
                    { name: "Thunderous Surge (Instant Heal)", description: "Stormwing can call down the full force of a massive thunderstorm, channeling overwhelming lightning through his entire body that instantly regenerates all damaged tissue and restores him to perfect health.", isInstantHeal: true }
                ]
            },
            metalbeak: {
                name: "Metalbeak the Forgeguard",
                element: "Metal",
                image: "images/metalbeak.jpg",
                powers: [
                    { name: "Metal Shaping", description: "Metalbeak can reshape metal with his heat alone, crafting weapons and tools without ever needing a forge or hammer, molding metal with just his touch." },
                    { name: "Unbreakable Claws", description: "His claws can cut through any material, from the hardest stone to the most resilient crystal, making him the lair's ultimate craftsman." },
                    { name: "Bell Resonance", description: "His steel-gray scales ring like bells when struck, creating beautiful musical tones that can be used for communication or celebration." },
                    { name: "Alloy Creation", description: "Metalbeak can combine different metals using his body heat, creating new alloys with unique properties never seen before." },
                    { name: "Metal Sensing", description: "He can detect and locate metal ores and deposits deep underground, working with Earthheart to mine the finest materials for forging." },
                    { name: "Metallic Repair (Healing)", description: "Metalbeak can heat his scales to forge-like temperatures, using his mastery over metal to repair damaged scales and seal wounds with molten steel that cools into perfect healing armor.", isHealing: true },
                    { name: "Steel Barrier (Shield)", description: "Metalbeak can forge an unbreakable shield of pure steel around himself, creating a protective barrier of solid metal that blocks and absorbs incoming damage.", isShield: true },
                    { name: "Perfect Forge Rebirth (Instant Heal)", description: "Metalbeak can forge himself anew in the perfect forge of his own body heat, instantly reforging every damaged scale and wound with flawless molten steel that cools into perfect health.", isInstantHeal: true }
                ]
            },
            vineclaw: {
                name: "Vineclaw the Lifegiver",
                element: "Nature",
                image: "images/vineclaw.jpg",
                powers: [
                    { name: "Living Gardens", description: "Vineclaw can create living gardens anywhere in the lair, growing food-bearing plants that never need water or sunlight, providing sustenance for all." },
                    { name: "Instant Growth", description: "Her claws can instantly grow plants from any surface, creating vines, flowers, or trees in seconds wherever she touches." },
                    { name: "Moss Armor", description: "Her scales are covered in living moss and flowers that provide natural camouflage and allow her to blend with any garden environment." },
                    { name: "Healing Pollen", description: "Vineclaw can release pollen from her flowers that has gentle healing properties, restoring energy and soothing wounds." },
                    { name: "Seed Spreading", description: "She can create and scatter seeds that grow into any plant she imagines, populating barren areas with lush vegetation in moments." },
                    { name: "Life Force Regeneration (Healing)", description: "Vineclaw can channel the very essence of life itself, causing healing vines and flowers to sprout from her wounds, drawing upon nature's infinite vitality to restore her health.", isHealing: true },
                    { name: "Thorny Barrier (Shield)", description: "Vineclaw can instantly grow a protective barrier of thick, thorny vines and brambles around herself, creating a natural shield that blocks and entangles incoming attacks.", isShield: true },
                    { name: "Nature's Ultimate Gift (Instant Heal)", description: "Vineclaw can channel the infinite life force of nature itself, causing a massive bloom of life-giving flowers and vines to instantly sprout from every wound, completely restoring her health in a single burst of pure vitality.", isInstantHeal: true }
                ]
            },
            shadowmaw: {
                name: "Shadowmaw the Nightstalker",
                element: "Shadow",
                image: "images/shadowmaw.jpg",
                powers: [
                    { name: "Shadow Meld", description: "Shadowmaw can merge with shadows to become completely invisible, allowing him to move undetected through even the brightest areas." },
                    { name: "Absolute Darkness", description: "He can create darkness so deep that even dragon fire cannot penetrate it, forming impenetrable shadow barriers." },
                    { name: "Shadow Teleportation", description: "By traveling through shadows, Shadowmaw can instantly move from one shadowed area to another anywhere in the lair." },
                    { name: "Light Absorption", description: "His scales absorb light around him, creating pockets of darkness that make nearby areas dimmer and more shadowy." },
                    { name: "Shadow Form", description: "Shadowmaw can transform parts of his body into pure shadow, allowing him to pass through small spaces or become intangible." },
                    { name: "Shadow Regeneration (Healing)", description: "Shadowmaw can merge his wounds with the darkness itself, causing them to become intangible shadows that slowly fade away as he draws strength from the endless void to restore his health.", isHealing: true },
                    { name: "Shadow Barrier (Shield)", description: "Shadowmaw can create a barrier of absolute darkness around himself, forming an impenetrable shadow shield that makes incoming attacks pass harmlessly through the void.", isShield: true },
                    { name: "Void Rebirth (Instant Heal)", description: "Shadowmaw can completely merge with the endless void itself, becoming pure shadow that instantly erases all wounds from existence and emerges from the darkness fully restored to perfect health.", isInstantHeal: true }
                ]
            },
            aquaris: {
                name: "Aquaris the Depthcaller",
                element: "Water",
                image: "images/aquaris.jpg",
                powers: [
                    { name: "Gravity-Defying Water", description: "Aquaris can breathe water that flows upward, creating waterfalls that defy gravity and fill the lair's pools from below." },
                    { name: "Whirlpool Tail", description: "Her tail can create powerful whirlpools with a single flick, capable of controlling water flow or creating defensive water barriers." },
                    { name: "Healing Waters", description: "Aquaris's water has gentle healing properties, restoring energy and soothing wounds when dragons bathe in her pools." },
                    { name: "Water Breathing", description: "She can create bubbles of breathable water, allowing other dragons to breathe underwater or survive in flooded areas." },
                    { name: "Current Control", description: "Aquaris can manipulate water currents with precision, creating flowing streams for transportation or powerful jets for defense." },
                    { name: "Aquatic Restoration (Healing)", description: "Aquaris can channel pure, life-giving water through her body, causing her wounds to wash clean and heal as if bathed in the most pristine healing springs of the deepest ocean.", isHealing: true },
                    { name: "Aquatic Barrier (Shield)", description: "Aquaris can create a protective barrier of swirling water around herself, forming a shield of flowing currents that redirects and absorbs incoming attacks with fluid grace.", isShield: true },
                    { name: "Ocean's Complete Restoration (Instant Heal)", description: "Aquaris can channel the infinite healing power of the deepest ocean itself, summoning a massive wave of pure life-giving water that instantly washes away all wounds and restores her to perfect health.", isInstantHeal: true }
                ]
            }
        };

        // Function to display selected dragon
        function displayDragon(dragonId, sideNumber) {
            const displayDiv = document.getElementById('dragon' + sideNumber + '-display');
            const dragon = dragonData[dragonId];
            
            if (!dragon) {
                displayDiv.innerHTML = '';
                return;
            }

            let powersHTML = '<h4>Powers</h4><ol>';
            dragon.powers.forEach(function(power) {
                powersHTML += '<li><strong>' + power.name + ':</strong> ' + power.description + '</li>';
            });
            powersHTML += '</ol>';

            // Get element class for proper styling
            const elementClass = getElementClass(dragon.element);
            
            displayDiv.innerHTML = `
                <div class="selected-dragon ${elementClass}">
                    <img src="${dragon.image}" alt="${dragon.name}" />
                    <h3>${dragon.name}</h3>
                    <p class="element">Element: ${dragon.element}</p>
                    ${powersHTML}
                </div>
            `;
        }

        // Function to get element class name
        function getElementClass(element) {
            const elementMap = {
                'fire': 'fire',
                'water': 'water',
                'lightning': 'lightning',
                'earth': 'earth',
                'air': 'air',
                'ice': 'ice',
                'shadow': 'shadow',
                'light': 'light',
                'nature': 'nature',
                'metal': 'metal',
                'crystal': 'crystal',
                'chaos': 'chaos'
            };
            return elementMap[element.toLowerCase()] || '';
        }

        // Function to enable/disable battle button
        function updateBattleButton() {
            const dragon1Select = document.getElementById('dragon1-select');
            const selected1 = dragon1Select.value;
            const battleButton = document.getElementById('battle-button');
            
            if (selected1 && selected1 !== '') {
                battleButton.disabled = false;
            } else {
                battleButton.disabled = true;
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const dragon1Select = document.getElementById('dragon1-select');
            const battleButton = document.getElementById('battle-button');

            // Dragon selection (player's dragon only)
            dragon1Select.addEventListener('change', function() {
                const selected = this.value;
                
                if (selected) {
                    displayDragon(selected, 1);
                } else {
                    document.getElementById('dragon1-display').innerHTML = '';
                }
                updateBattleButton();
            });

            // Battle button
            battleButton.addEventListener('click', function() {
                console.log('Start Single Player button clicked!');
                startBattle();
            });

            // New Battle button
            const newBattleButton = document.getElementById('new-battle-button');
            if (newBattleButton) {
                newBattleButton.addEventListener('click', function() {
                    resetBattle();
                });
            }

            // HP Control Toggle
            const hpControlToggle = document.getElementById('hp-control-toggle');
            const hpSetButton = document.getElementById('hp-set-button');
            
            if (hpControlToggle && hpSetButton) {
                // Initialize toggle state (false by default)
                let hpControlEnabled = false;
                hpControlToggle.checked = false;
                hpSetButton.classList.add('hidden');

                // Toggle event listener
                hpControlToggle.addEventListener('change', function() {
                    hpControlEnabled = this.checked;
                    if (hpControlEnabled) {
                        hpSetButton.classList.remove('hidden');
                    } else {
                        hpSetButton.classList.add('hidden');
                    }
                });

                // HP Set Button click handler
                hpSetButton.addEventListener('click', function() {
                    // Set both dragons' HP to 5
                    updateHealthBar(1, 5);
                    updateHealthBar(2, 5);
                    // Note: Shields remain unchanged when using HP button
                });
            }
        });

        // Store battle state
        let battleState = {
            dragon1: null,
            dragon2: null,
            dragon1Id: null,
            dragon2Id: null,
            dragon1HP: 10,
            dragon2HP: 10,
            dragon1Shield: 0,
            dragon2Shield: 0,
            dragon1ShieldUses: 0,
            dragon2ShieldUses: 0,
            dragon1Power: null,
            dragon2Power: null
        };

        // Function to start the battle
        function startBattle() {
            const dragon1Id = document.getElementById('dragon1-select').value;

            if (!dragon1Id) {
                return;
            }

            // Randomly select a bot dragon (different from player's dragon)
            const allDragonIds = Object.keys(dragonData);
            const availableDragons = allDragonIds.filter(id => id !== dragon1Id);
            const randomIndex = Math.floor(Math.random() * availableDragons.length);
            const dragon2Id = availableDragons[randomIndex];

            const dragon1 = dragonData[dragon1Id];
            const dragon2 = dragonData[dragon2Id];

            if (!dragon1 || !dragon2) {
                return;
            }

            // Reset battle state
            battleState = {
                dragon1: dragon1,
                dragon2: dragon2,
                dragon1Id: dragon1Id,
                dragon2Id: dragon2Id,
                dragon1HP: 10,
                dragon2HP: 10,
                dragon1Shield: 0,
                dragon2Shield: 0,
                dragon1ShieldUses: 0,
                dragon2ShieldUses: 0,
                dragon1InstantHealUsed: false,
                dragon2InstantHealUsed: false,
                dragon1Power: null,
                dragon2Power: null
            };

            // Hide selection area and winner screen
            document.getElementById('selection-area').classList.add('hidden');
            document.getElementById('winner-screen').classList.add('hidden');
            
            // Show battle view
            const battleView = document.getElementById('battle-view');
            battleView.classList.add('active');

            // Display Dragon 1
            displayBattleDragon(dragon1, 1);
            
            // Display Dragon 2
            displayBattleDragon(dragon2, 2);

            // Initialize health bars at 10 HP and reset shields
            updateHealthBar(1, 10);
            updateHealthBar(2, 10);
            updateShieldDisplay(1, 0);
            updateShieldDisplay(2, 0);
            updateShieldUseDisplay(1, 0);
            updateShieldUseDisplay(2, 0);

            // Clear battle log
            document.getElementById('battle-log').innerHTML = '<p style="color: #88CCFF; font-weight: bold;">Battle begins! Select powers for both dragons and click FIGHT!!!!</p>';
            
            // Initialize attack summary
            const attackSummary = document.getElementById('attack-summary');
            if (attackSummary) {
                attackSummary.innerHTML = '<p style="color: #88CCFF; font-weight: bold;">Select powers and click FIGHT!</p>';
            }

            // Reset fight button
            const fightButton = document.getElementById('fight-button');
            fightButton.disabled = true;

            // Set up power selection listeners
            setupPowerSelectionListeners();
            
            // Bot automatically selects a power when battle starts
            botSelectPower();
            checkFightButtonState();
        }

        // Function to display dragon in battle view
        function displayBattleDragon(dragon, sideNumber) {
            const elementClass = getElementClass(dragon.element);
            
            // Update dragon card
            const card = document.getElementById('battle-dragon' + sideNumber + '-card');
            card.className = 'battle-dragon-card ' + elementClass;
            
            // Update image
            document.getElementById('battle-dragon' + sideNumber + '-image').src = dragon.image;
            document.getElementById('battle-dragon' + sideNumber + '-image').alt = dragon.name;
            
            // Update name
            document.getElementById('battle-dragon' + sideNumber + '-name').textContent = dragon.name;
            
            // Update element
            document.getElementById('battle-dragon' + sideNumber + '-element').textContent = 'Element: ' + dragon.element;
            
            // Populate powers dropdown for player (dragon1) or show text for bot (dragon2)
            const powersElement = document.getElementById('battle-dragon' + sideNumber + '-powers');
            
            if (sideNumber === 1) {
                // Player's dragon - use dropdown
                powersElement.innerHTML = '<option value="">-- Select a Power --</option>';
                dragon.powers.forEach(function(power, index) {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = power.name;
                    
                    // Disable shield powers if they've been used 3 times
                    if (power.isShield === true) {
                        const shieldUses = battleState.dragon1ShieldUses;
                        if (shieldUses >= 3) {
                            option.disabled = true;
                            option.textContent = power.name + ' (Used 3/3)';
                        }
                    }
                    
                    // Disable instant heal powers if they've been used
                    if (power.isInstantHeal === true) {
                        if (battleState.dragon1InstantHealUsed) {
                            option.disabled = true;
                            option.textContent = power.name + ' (Used 1/1)';
                        }
                    }
                    
                    powersElement.appendChild(option);
                });
            } else {
                // Bot's dragon - show as text (will be updated when bot selects power)
                powersElement.textContent = '-- Bot will select power --';
            }
        }

        // Function to update health bar
        function updateHealthBar(sideNumber, currentHP) {
            const maxHP = 10;
            const percentage = Math.max(0, (currentHP / maxHP) * 100);
            
            // Update display
            document.getElementById('hp' + sideNumber + '-display').textContent = Math.max(0, currentHP);
            
            // Update health bar
            const healthBar = document.getElementById('hp' + sideNumber + '-bar');
            healthBar.style.width = percentage + '%';
            healthBar.textContent = Math.max(0, currentHP) + ' HP';
            
            // Update color based on health
            healthBar.className = 'health-bar-fill';
            if (percentage <= 33) {
                healthBar.classList.add('low');
            } else if (percentage <= 66) {
                healthBar.classList.add('medium');
            }

            // Update battle state
            if (sideNumber === 1) {
                battleState.dragon1HP = Math.max(0, currentHP);
            } else {
                battleState.dragon2HP = Math.max(0, currentHP);
            }
        }

        // Function to update shield display
        function updateShieldDisplay(sideNumber, shieldValue) {
            const shieldLabel = document.getElementById('shield' + sideNumber + '-label');
            const shieldDisplay = document.getElementById('shield' + sideNumber + '-display');
            
            if (shieldValue > 0) {
                shieldLabel.style.display = 'block';
                shieldDisplay.textContent = shieldValue;
                
                // Update battle state
                if (sideNumber === 1) {
                    battleState.dragon1Shield = shieldValue;
                } else {
                    battleState.dragon2Shield = shieldValue;
                }
            } else {
                shieldLabel.style.display = 'none';
                shieldDisplay.textContent = '0';
                
                // Update battle state
                if (sideNumber === 1) {
                    battleState.dragon1Shield = 0;
                } else {
                    battleState.dragon2Shield = 0;
                }
            }
        }

        // Function to update shield use count display
        function updateShieldUseDisplay(sideNumber, shieldUses) {
            const shieldUseDisplay = document.getElementById('shield' + sideNumber + '-uses-display');
            if (shieldUseDisplay) {
                shieldUseDisplay.textContent = shieldUses;
                
                // Change color based on uses
                const shieldUseLabel = shieldUseDisplay.parentElement;
                if (shieldUses >= 3) {
                    shieldUseLabel.style.color = '#FF8888'; // Red when maxed out
                } else if (shieldUses >= 2) {
                    shieldUseLabel.style.color = '#FFAA88'; // Orange when getting close
                } else {
                    shieldUseLabel.style.color = '#AAAAFF'; // Default blue
                }
            }
        }

        // Function to make bot select a smart power
        function botSelectPower() {
            if (!battleState.dragon2) {
                return;
            }
            
            // Get available powers (exclude shield powers that have been used 3 times, and instant heal if used)
            const availablePowers = [];
            const healingPowers = [];
            const instantHealPowers = [];
            const shieldPowers = [];
            const damagePowers = [];
            
            battleState.dragon2.powers.forEach(function(power, index) {
                if (power.isShield === true && battleState.dragon2ShieldUses >= 3) {
                    // Skip shield powers that have been used 3 times
                    return;
                }
                
                if (power.isInstantHeal === true && battleState.dragon2InstantHealUsed) {
                    // Skip instant heal powers that have been used
                    return;
                }
                
                availablePowers.push({ power: power, index: index });
                
                // Categorize powers
                if (power.isInstantHeal === true) {
                    instantHealPowers.push({ power: power, index: index });
                } else if (power.isHealing === true) {
                    healingPowers.push({ power: power, index: index });
                } else if (power.isShield === true) {
                    shieldPowers.push({ power: power, index: index });
                } else {
                    damagePowers.push({ power: power, index: index });
                }
            });
            
            if (availablePowers.length === 0) {
                // No available powers, select first power anyway
                battleState.dragon2Power = battleState.dragon2.powers[0];
                document.getElementById('battle-dragon2-powers').textContent = battleState.dragon2.powers[0].name;
                return;
            }
            
            let selected = null;
            const botHP = battleState.dragon2HP;
            const botShield = battleState.dragon2Shield;
            const playerHP = battleState.dragon1HP;
            const maxHP = 10;
            
            // Smart bot strategy based on HP and shield status:
            // 1. Critical HP (2 or less): ALWAYS heal if available (survival priority)
            // 2. Low HP (3-4) with no shield: Use shield first for protection, then heal if shield exists
            // 3. Low HP (3-4) with shield: Heal to recover
            // 4. Medium HP (5-7): Use damage, but build shield if no shield exists
            // 5. High HP (8+): Use damage attacks
            
            if (botHP <= 2) {
                // Critical HP - ALWAYS use instant heal if available (survival is top priority), otherwise regular heal
                if (instantHealPowers.length > 0) {
                    // Use instant heal for critical HP
                    const randomIndex = Math.floor(Math.random() * instantHealPowers.length);
                    selected = instantHealPowers[randomIndex];
                } else if (healingPowers.length > 0) {
                    const randomIndex = Math.floor(Math.random() * healingPowers.length);
                    selected = healingPowers[randomIndex];
                } else if (shieldPowers.length > 0 && botShield === 0) {
                    // No healing available, use shield for protection
                    const randomIndex = Math.floor(Math.random() * shieldPowers.length);
                    selected = shieldPowers[randomIndex];
                } else if (damagePowers.length > 0) {
                    // Last resort: damage
                    const randomIndex = Math.floor(Math.random() * damagePowers.length);
                    selected = damagePowers[randomIndex];
                }
            } else if (botHP <= 4) {
                // Low HP - prioritize instant heal, protection, or regular healing
                if (instantHealPowers.length > 0 && botHP <= 3) {
                    // Use instant heal if HP is very low (3 or less)
                    const randomIndex = Math.floor(Math.random() * instantHealPowers.length);
                    selected = instantHealPowers[randomIndex];
                } else if (botShield === 0 && shieldPowers.length > 0) {
                    // No shield - build protection first
                    const randomIndex = Math.floor(Math.random() * shieldPowers.length);
                    selected = shieldPowers[randomIndex];
                } else if (healingPowers.length > 0) {
                    // Has shield or no shield available - heal to recover HP
                    const randomIndex = Math.floor(Math.random() * healingPowers.length);
                    selected = healingPowers[randomIndex];
                } else if (damagePowers.length > 0) {
                    // No healing available - use damage
                    const randomIndex = Math.floor(Math.random() * damagePowers.length);
                    selected = damagePowers[randomIndex];
                }
            } else if (botHP <= 7) {
                // Medium HP - balance offense and defense
                if (botShield === 0 && shieldPowers.length > 0) {
                    // No shield - build some protection (50% chance to be strategic)
                    if (Math.random() < 0.5) {
                        const randomIndex = Math.floor(Math.random() * shieldPowers.length);
                        selected = shieldPowers[randomIndex];
                    } else {
                        // Otherwise use damage
                        const randomIndex = Math.floor(Math.random() * damagePowers.length);
                        selected = damagePowers[randomIndex];
                    }
                } else {
                    // Has shield or no shield power - use damage
                    const randomIndex = Math.floor(Math.random() * damagePowers.length);
                    selected = damagePowers[randomIndex];
                }
            } else {
                // High HP (8+) - focus on offense
                if (damagePowers.length > 0) {
                    const randomIndex = Math.floor(Math.random() * damagePowers.length);
                    selected = damagePowers[randomIndex];
                } else if (shieldPowers.length > 0 && botShield === 0) {
                    // Only shield available and no shield - use it
                    const randomIndex = Math.floor(Math.random() * shieldPowers.length);
                    selected = shieldPowers[randomIndex];
                } else if (healingPowers.length > 0) {
                    // Only healing available - use it (won't hurt)
                    const randomIndex = Math.floor(Math.random() * healingPowers.length);
                    selected = healingPowers[randomIndex];
                }
            }
            
            // Fallback: if no selection was made, randomly select from all available
            if (!selected) {
                const randomIndex = Math.floor(Math.random() * availablePowers.length);
                selected = availablePowers[randomIndex];
            }
            
            battleState.dragon2Power = selected.power;
            
            // Update bot's power display
            document.getElementById('battle-dragon2-powers').textContent = selected.power.name;
        }

        // Set up power selection listeners
        function setupPowerSelectionListeners() {
            const power1Select = document.getElementById('battle-dragon1-powers');
            const fightButton = document.getElementById('fight-button');

            power1Select.addEventListener('change', function() {
                const powerIndex = parseInt(this.value);
                if (powerIndex >= 0 && battleState.dragon1) {
                    const selectedPower = battleState.dragon1.powers[powerIndex];
                    // Check if this is a shield power that has been used 3 times
                    if (selectedPower.isShield === true && battleState.dragon1ShieldUses >= 3) {
                        // Reset to empty if trying to select a shield power that's been used 3 times
                        this.value = '';
                        battleState.dragon1Power = null;
                        alert('Shield power has been used 3 times and cannot be used again!');
                    } else if (selectedPower.isInstantHeal === true && battleState.dragon1InstantHealUsed) {
                        // Reset to empty if trying to select an instant heal power that's been used
                        this.value = '';
                        battleState.dragon1Power = null;
                        alert('Instant Heal power has been used and cannot be used again!');
                    } else {
                        battleState.dragon1Power = selectedPower;
                        // Bot automatically selects a power when player selects theirs
                        botSelectPower();
                    }
                } else {
                    battleState.dragon1Power = null;
                    battleState.dragon2Power = null;
                    document.getElementById('battle-dragon2-powers').textContent = '-- Bot will select power --';
                }
                checkFightButtonState();
            });

            fightButton.addEventListener('click', function() {
                executeBattle();
            });
        }

        // Check if fight button should be enabled
        function checkFightButtonState() {
            const fightButton = document.getElementById('fight-button');
            if (battleState.dragon1Power && battleState.dragon2Power) {
                fightButton.disabled = false;
            } else {
                fightButton.disabled = true;
            }
        }

        // Execute the battle
        function executeBattle() {
            const battleLog = document.getElementById('battle-log');
            battleLog.innerHTML = '';

            // Disable fight button during battle
            document.getElementById('fight-button').disabled = true;

            // Check if powers are healing, shield, or instant heal powers
            const isHealing1 = battleState.dragon1Power && battleState.dragon1Power.isHealing === true;
            const isHealing2 = battleState.dragon2Power && battleState.dragon2Power.isHealing === true;
            let isShield1 = battleState.dragon1Power && battleState.dragon1Power.isShield === true;
            let isShield2 = battleState.dragon2Power && battleState.dragon2Power.isShield === true;
            const isInstantHeal1 = battleState.dragon1Power && battleState.dragon1Power.isInstantHeal === true;
            const isInstantHeal2 = battleState.dragon2Power && battleState.dragon2Power.isInstantHeal === true;
            
            // Prevent using shield power if it's been used 3 times
            if (isShield1 && battleState.dragon1ShieldUses >= 3) {
                battleLog.innerHTML += '<p style="color: #FF4444; font-weight: bold;">' + battleState.dragon1.name + ' cannot use shield power - it has been used 3 times already!</p>';
                document.getElementById('battle-dragon1-powers').value = '';
                battleState.dragon1Power = null;
                checkFightButtonState();
                document.getElementById('fight-button').disabled = false;
                return;
            }
            
            if (isShield2 && battleState.dragon2ShieldUses >= 3) {
                battleLog.innerHTML += '<p style="color: #FF4444; font-weight: bold;">' + battleState.dragon2.name + ' cannot use shield power - it has been used 3 times already!</p>';
                battleState.dragon2Power = null;
                document.getElementById('battle-dragon2-powers').textContent = '-- Bot will select power --';
                checkFightButtonState();
                document.getElementById('fight-button').disabled = false;
                return;
            }
            
            // Prevent using instant heal power if it's been used
            if (isInstantHeal1 && battleState.dragon1InstantHealUsed) {
                battleLog.innerHTML += '<p style="color: #FF4444; font-weight: bold;">' + battleState.dragon1.name + ' cannot use Instant Heal power - it has been used already!</p>';
                document.getElementById('battle-dragon1-powers').value = '';
                battleState.dragon1Power = null;
                checkFightButtonState();
                document.getElementById('fight-button').disabled = false;
                return;
            }
            
            if (isInstantHeal2 && battleState.dragon2InstantHealUsed) {
                battleLog.innerHTML += '<p style="color: #FF4444; font-weight: bold;">' + battleState.dragon2.name + ' cannot use Instant Heal power - it has been used already!</p>';
                battleState.dragon2Power = null;
                document.getElementById('battle-dragon2-powers').textContent = '-- Bot will select power --';
                checkFightButtonState();
                document.getElementById('fight-button').disabled = false;
                return;
            }

            // Get power values (1-5 random) for each dragon
            const power1 = Math.floor(Math.random() * 5) + 1;
            const power2 = Math.floor(Math.random() * 5) + 1;

            // Both dragons use their powers
            let logMessage = '<p class="attack-message">' + battleState.dragon1.name + ' uses ' + battleState.dragon1Power.name + '!</p>';
            logMessage += '<p>' + createBattleMessage(battleState.dragon1.name, battleState.dragon1Power) + ' (Power: ' + power1 + ')</p>';
            logMessage += '<p class="attack-message">' + battleState.dragon2.name + ' uses ' + battleState.dragon2Power.name + '!</p>';
            logMessage += '<p>' + createBattleMessage(battleState.dragon2.name, battleState.dragon2Power) + ' (Power: ' + power2 + ')</p>';
            
            battleLog.innerHTML += logMessage;
            
            // Attack summary will be updated with final result after battle resolves
            // (no initial power usage display)

            // Compare power values - same logic regardless of power type
            setTimeout(function() {
                let logMessage = '';
                const maxHP = 10;

                if (power1 > power2) {
                    // Dragon 1 wins
                    const difference = power1 - power2;
                    
                    if (isInstantHeal1) {
                        // Dragon 1 is using instant heal - fully restore HP
                        battleState.dragon1InstantHealUsed = true;
                        const oldHP1 = battleState.dragon1HP;
                        const newHP1 = maxHP; // Instant heal restores to full HP
                        updateHealthBar(1, newHP1);
                        
                        // Disable instant heal power in dropdown
                        const powerDropdown1 = document.getElementById('battle-dragon1-powers');
                        const currentPowerIndex = battleState.dragon1.powers.indexOf(battleState.dragon1Power);
                        for (let i = 0; i < powerDropdown1.options.length; i++) {
                            const optionValue = powerDropdown1.options[i].value;
                            if (optionValue && parseInt(optionValue) === currentPowerIndex) {
                                powerDropdown1.options[i].disabled = true;
                                powerDropdown1.options[i].textContent = battleState.dragon1Power.name + ' (Used 1/1)';
                                break;
                            }
                        }
                        
                        logMessage += '<p class="result-message">' + battleState.dragon1.name + ' wins this round! (' + power1 + ' vs ' + power2 + ')</p>';
                        logMessage += '<p style="color: #44FF44; font-weight: bold; font-size: 14px;">' + battleState.dragon1.name + ' uses Instant Heal and fully restores to ' + newHP1 + ' HP! (' + oldHP1 + ' -> ' + newHP1 + ' HP)</p>';
                        logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + newHP1 + ' HP | ' + battleState.dragon2.name + ' - ' + battleState.dragon2HP + ' HP</p>';
                        if (battleState.dragon1Shield > 0 || battleState.dragon2Shield > 0) {
                            let shieldInfo = '';
                            if (battleState.dragon1Shield > 0) {
                                shieldInfo += battleState.dragon1.name + ' (Shield: ' + battleState.dragon1Shield + ')';
                            }
                            if (battleState.dragon2Shield > 0) {
                                if (shieldInfo) shieldInfo += ' | ';
                                shieldInfo += battleState.dragon2.name + ' (Shield: ' + battleState.dragon2Shield + ')';
                            }
                            if (shieldInfo) {
                                logMessage += '<p style="color: #8888FF;">' + shieldInfo + '</p>';
                            }
                        }
                        
                        // Update attack summary with result
                        const attackSummary = document.getElementById('attack-summary');
                        if (attackSummary) {
                            attackSummary.innerHTML = '<p style="color: #44FF44; font-weight: bold;">' + battleState.dragon1.name + ' fully healed</p>';
                        }
                        
                        // Clear selection after instant heal is used
                        if (powerDropdown1.value && parseInt(powerDropdown1.value) === currentPowerIndex) {
                            powerDropdown1.value = '';
                            battleState.dragon1Power = null;
                            checkFightButtonState();
                        }
                    } else if (isHealing1) {
                        // Dragon 1 is using healing - heal themselves
                        const oldHP1 = battleState.dragon1HP;
                        const newHP1 = Math.min(oldHP1 + difference, maxHP);
                        const actualHeal = newHP1 - oldHP1;
                        updateHealthBar(1, newHP1);
                        
                        logMessage += '<p class="result-message">' + battleState.dragon1.name + ' wins this round! (' + power1 + ' vs ' + power2 + ')</p>';
                        if (actualHeal > 0) {
                            logMessage += '<p style="color: #44FF44; font-weight: bold;">' + battleState.dragon1.name + ' heals ' + actualHeal + ' HP! (' + oldHP1 + ' -> ' + newHP1 + ' HP)</p>';
                        } else {
                            logMessage += '<p>' + battleState.dragon1.name + ' is already at full health!</p>';
                        }
                        logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + newHP1 + ' HP | ' + battleState.dragon2.name + ' - ' + battleState.dragon2HP + ' HP</p>';
                        if (battleState.dragon1Shield > 0 || battleState.dragon2Shield > 0) {
                            let shieldInfo = '';
                            if (battleState.dragon1Shield > 0) {
                                shieldInfo += battleState.dragon1.name + ' (Shield: ' + battleState.dragon1Shield + ')';
                            }
                            if (battleState.dragon2Shield > 0) {
                                if (shieldInfo) shieldInfo += ' | ';
                                shieldInfo += battleState.dragon2.name + ' (Shield: ' + battleState.dragon2Shield + ')';
                            }
                            if (shieldInfo) {
                                logMessage += '<p style="color: #8888FF;">' + shieldInfo + '</p>';
                            }
                        }
                        
                        // Update attack summary with result
                        const attackSummary = document.getElementById('attack-summary');
                        if (attackSummary) {
                            if (actualHeal > 0) {
                                attackSummary.innerHTML = '<p style="color: #44FF44; font-weight: bold;">' + battleState.dragon1.name + ' healed ' + actualHeal + ' HP</p>';
                            } else {
                                attackSummary.innerHTML = '<p>' + battleState.dragon1.name + ' is at full health</p>';
                            }
                        }
                    } else if (isShield1) {
                        // Dragon 1 is using shield - gain shield points instead of dealing damage
                        battleState.dragon1Shield += difference;
                        battleState.dragon1ShieldUses++;
                        updateShieldDisplay(1, battleState.dragon1Shield);
                        updateShieldUseDisplay(1, battleState.dragon1ShieldUses);
                        
                        // Update dropdown to disable shield power if limit reached
                        if (battleState.dragon1ShieldUses >= 3) {
                            const powerDropdown1 = document.getElementById('battle-dragon1-powers');
                            const currentPowerIndex = battleState.dragon1.powers.indexOf(battleState.dragon1Power);
                            for (let i = 0; i < powerDropdown1.options.length; i++) {
                                const optionValue = powerDropdown1.options[i].value;
                                if (optionValue && parseInt(optionValue) === currentPowerIndex) {
                                    powerDropdown1.options[i].disabled = true;
                                    powerDropdown1.options[i].textContent = battleState.dragon1Power.name + ' (Used 3/3)';
                                    break;
                                }
                            }
                            // Clear selection if this shield power was currently selected
                            if (powerDropdown1.value && parseInt(powerDropdown1.value) === currentPowerIndex) {
                                powerDropdown1.value = '';
                                battleState.dragon1Power = null;
                                checkFightButtonState();
                            }
                        }
                        
                        logMessage += '<p class="result-message">' + battleState.dragon1.name + ' wins this round! (' + power1 + ' vs ' + power2 + ')</p>';
                        logMessage += '<p style="color: #8888FF; font-weight: bold;">' + battleState.dragon1.name + ' gains ' + difference + ' shield points! (Shield: ' + battleState.dragon1Shield + ') [' + battleState.dragon1ShieldUses + '/3 uses]</p>';
                        logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + battleState.dragon1HP + ' HP | ' + battleState.dragon2.name + ' - ' + battleState.dragon2HP + ' HP</p>';
                        
                        // Update attack summary with result
                        const attackSummary = document.getElementById('attack-summary');
                        if (attackSummary) {
                            attackSummary.innerHTML = '<p style="color: #8888FF; font-weight: bold;">' + battleState.dragon1.name + ' gained ' + difference + ' shield points</p>';
                        }
                    } else {
                        // Dragon 1 is using damage - deal damage to Dragon 2 (shields block first)
                        let remainingDamage = difference;
                        
                        // Shield blocks damage first
                        if (battleState.dragon2Shield > 0) {
                            const shieldBlocked = Math.min(battleState.dragon2Shield, remainingDamage);
                            battleState.dragon2Shield -= shieldBlocked;
                            remainingDamage -= shieldBlocked;
                            updateShieldDisplay(2, battleState.dragon2Shield);
                            logMessage += '<p style="color: #8888FF;">' + battleState.dragon2.name + '\'s shield blocks ' + shieldBlocked + ' damage!</p>';
                        }
                        
                        // Remaining damage goes to HP
                        const newHP2 = Math.max(0, battleState.dragon2HP - remainingDamage);
                        updateHealthBar(2, newHP2);
                        
                        logMessage += '<p class="result-message">' + battleState.dragon1.name + ' wins this round! (' + power1 + ' vs ' + power2 + ')</p>';
                        if (remainingDamage > 0) {
                            logMessage += '<p class="damage-message">' + battleState.dragon1.name + ' deals ' + remainingDamage + ' damage to ' + battleState.dragon2.name + '!</p>';
                        }
                        logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + battleState.dragon1HP + ' HP | ' + battleState.dragon2.name + ' - ' + newHP2 + ' HP</p>';
                        if (battleState.dragon1Shield > 0 || battleState.dragon2Shield > 0) {
                            let shieldInfo = '';
                            if (battleState.dragon1Shield > 0) {
                                shieldInfo += battleState.dragon1.name + ' (Shield: ' + battleState.dragon1Shield + ')';
                            }
                            if (battleState.dragon2Shield > 0) {
                                if (shieldInfo) shieldInfo += ' | ';
                                shieldInfo += battleState.dragon2.name + ' (Shield: ' + battleState.dragon2Shield + ')';
                            }
                            if (shieldInfo) {
                                logMessage += '<p style="color: #8888FF;">' + shieldInfo + '</p>';
                            }
                        }
                        
                        // Update attack summary with result
                        const attackSummary = document.getElementById('attack-summary');
                        if (attackSummary) {
                            if (remainingDamage > 0) {
                                attackSummary.innerHTML = '<p class="damage-message">' + battleState.dragon1.name + ' dealt ' + remainingDamage + ' damage</p>';
                            } else {
                                attackSummary.innerHTML = '<p style="color: #8888FF;">' + battleState.dragon2.name + '\'s shield blocked all damage</p>';
                            }
                        }
                        
                        // Check if battle is over (use newHP2, not battleState which may not be updated yet)
                        if (newHP2 <= 0) {
                            battleLog.innerHTML += logMessage;
                            setTimeout(function() {
                                showWinner();
                            }, 1500);
                            return;
                        }
                    }
                } else if (power2 > power1) {
                    // Dragon 2 wins
                    const difference = power2 - power1;
                    
                    if (isInstantHeal2) {
                        // Dragon 2 (bot) is using instant heal - fully restore HP
                        battleState.dragon2InstantHealUsed = true;
                        const oldHP2 = battleState.dragon2HP;
                        const newHP2 = maxHP; // Instant heal restores to full HP
                        updateHealthBar(2, newHP2);
                        
                        logMessage += '<p class="result-message">' + battleState.dragon2.name + ' wins this round! (' + power2 + ' vs ' + power1 + ')</p>';
                        logMessage += '<p style="color: #44FF44; font-weight: bold; font-size: 14px;">' + battleState.dragon2.name + ' uses Instant Heal and fully restores to ' + newHP2 + ' HP! (' + oldHP2 + ' -> ' + newHP2 + ' HP)</p>';
                        logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + battleState.dragon1HP + ' HP | ' + battleState.dragon2.name + ' - ' + newHP2 + ' HP</p>';
                        if (battleState.dragon1Shield > 0 || battleState.dragon2Shield > 0) {
                            let shieldInfo = '';
                            if (battleState.dragon1Shield > 0) {
                                shieldInfo += battleState.dragon1.name + ' (Shield: ' + battleState.dragon1Shield + ')';
                            }
                            if (battleState.dragon2Shield > 0) {
                                if (shieldInfo) shieldInfo += ' | ';
                                shieldInfo += battleState.dragon2.name + ' (Shield: ' + battleState.dragon2Shield + ')';
                            }
                            if (shieldInfo) {
                                logMessage += '<p style="color: #8888FF;">' + shieldInfo + '</p>';
                            }
                        }
                        
                        // Update attack summary with result
                        const attackSummary = document.getElementById('attack-summary');
                        if (attackSummary) {
                            attackSummary.innerHTML = '<p style="color: #44FF44; font-weight: bold;">' + battleState.dragon2.name + ' fully healed</p>';
                        }
                        
                        // Clear bot's power selection after instant heal is used
                        battleState.dragon2Power = null;
                        document.getElementById('battle-dragon2-powers').textContent = '-- Bot will select power --';
                        checkFightButtonState();
                    } else if (isHealing2) {
                        // Dragon 2 is using healing - heal themselves
                        const oldHP2 = battleState.dragon2HP;
                        const newHP2 = Math.min(oldHP2 + difference, maxHP);
                        const actualHeal = newHP2 - oldHP2;
                        updateHealthBar(2, newHP2);
                        
                        logMessage += '<p class="result-message">' + battleState.dragon2.name + ' wins this round! (' + power2 + ' vs ' + power1 + ')</p>';
                        if (actualHeal > 0) {
                            logMessage += '<p style="color: #44FF44; font-weight: bold;">' + battleState.dragon2.name + ' heals ' + actualHeal + ' HP! (' + oldHP2 + ' -> ' + newHP2 + ' HP)</p>';
                        } else {
                            logMessage += '<p>' + battleState.dragon2.name + ' is already at full health!</p>';
                        }
                        logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + battleState.dragon1HP + ' HP | ' + battleState.dragon2.name + ' - ' + newHP2 + ' HP</p>';
                        if (battleState.dragon1Shield > 0 || battleState.dragon2Shield > 0) {
                            let shieldInfo = '';
                            if (battleState.dragon1Shield > 0) {
                                shieldInfo += battleState.dragon1.name + ' (Shield: ' + battleState.dragon1Shield + ')';
                            }
                            if (battleState.dragon2Shield > 0) {
                                if (shieldInfo) shieldInfo += ' | ';
                                shieldInfo += battleState.dragon2.name + ' (Shield: ' + battleState.dragon2Shield + ')';
                            }
                            if (shieldInfo) {
                                logMessage += '<p style="color: #8888FF;">' + shieldInfo + '</p>';
                            }
                        }
                        
                        // Update attack summary with result
                        const attackSummary = document.getElementById('attack-summary');
                        if (attackSummary) {
                            if (actualHeal > 0) {
                                attackSummary.innerHTML = '<p style="color: #44FF44; font-weight: bold;">' + battleState.dragon2.name + ' healed ' + actualHeal + ' HP</p>';
                            } else {
                                attackSummary.innerHTML = '<p>' + battleState.dragon2.name + ' is at full health</p>';
                            }
                        }
                    } else if (isShield2) {
                        // Dragon 2 is using shield - gain shield points instead of dealing damage
                        battleState.dragon2Shield += difference;
                        battleState.dragon2ShieldUses++;
                        updateShieldDisplay(2, battleState.dragon2Shield);
                        updateShieldUseDisplay(2, battleState.dragon2ShieldUses);
                        
                        // Clear bot's power selection if shield uses are exhausted
                        if (battleState.dragon2ShieldUses >= 3) {
                            // Bot's power is displayed as text, not a dropdown
                            battleState.dragon2Power = null;
                            document.getElementById('battle-dragon2-powers').textContent = '-- Bot will select power --';
                            checkFightButtonState();
                        }
                        
                        logMessage += '<p class="result-message">' + battleState.dragon2.name + ' wins this round! (' + power2 + ' vs ' + power1 + ')</p>';
                        logMessage += '<p style="color: #8888FF; font-weight: bold;">' + battleState.dragon2.name + ' gains ' + difference + ' shield points! (Shield: ' + battleState.dragon2Shield + ') [' + battleState.dragon2ShieldUses + '/3 uses]</p>';
                        logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + battleState.dragon1HP + ' HP | ' + battleState.dragon2.name + ' - ' + battleState.dragon2HP + ' HP</p>';
                        if (battleState.dragon1Shield > 0 || battleState.dragon2Shield > 0) {
                            let shieldInfo = '';
                            if (battleState.dragon1Shield > 0) {
                                shieldInfo += battleState.dragon1.name + ' (Shield: ' + battleState.dragon1Shield + ')';
                            }
                            if (battleState.dragon2Shield > 0) {
                                if (shieldInfo) shieldInfo += ' | ';
                                shieldInfo += battleState.dragon2.name + ' (Shield: ' + battleState.dragon2Shield + ')';
                            }
                            if (shieldInfo) {
                                logMessage += '<p style="color: #8888FF;">' + shieldInfo + '</p>';
                            }
                        }
                        
                        // Update attack summary with result
                        const attackSummary = document.getElementById('attack-summary');
                        if (attackSummary) {
                            attackSummary.innerHTML = '<p style="color: #8888FF; font-weight: bold;">' + battleState.dragon2.name + ' gained ' + difference + ' shield points</p>';
                        }
                    } else {
                        // Dragon 2 is using damage - deal damage to Dragon 1 (shields block first)
                        let remainingDamage = difference;
                        
                        // Shield blocks damage first
                        if (battleState.dragon1Shield > 0) {
                            const shieldBlocked = Math.min(battleState.dragon1Shield, remainingDamage);
                            battleState.dragon1Shield -= shieldBlocked;
                            remainingDamage -= shieldBlocked;
                            updateShieldDisplay(1, battleState.dragon1Shield);
                            logMessage += '<p style="color: #8888FF;">' + battleState.dragon1.name + '\'s shield blocks ' + shieldBlocked + ' damage!</p>';
                        }
                        
                        // Remaining damage goes to HP
                        const newHP1 = Math.max(0, battleState.dragon1HP - remainingDamage);
                        updateHealthBar(1, newHP1);
                        
                        logMessage += '<p class="result-message">' + battleState.dragon2.name + ' wins this round! (' + power2 + ' vs ' + power1 + ')</p>';
                        if (remainingDamage > 0) {
                            logMessage += '<p class="damage-message">' + battleState.dragon2.name + ' deals ' + remainingDamage + ' damage to ' + battleState.dragon1.name + '!</p>';
                        }
                        logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + newHP1 + ' HP | ' + battleState.dragon2.name + ' - ' + battleState.dragon2HP + ' HP</p>';
                        if (battleState.dragon1Shield > 0 || battleState.dragon2Shield > 0) {
                            let shieldInfo = '';
                            if (battleState.dragon1Shield > 0) {
                                shieldInfo += battleState.dragon1.name + ' (Shield: ' + battleState.dragon1Shield + ')';
                            }
                            if (battleState.dragon2Shield > 0) {
                                if (shieldInfo) shieldInfo += ' | ';
                                shieldInfo += battleState.dragon2.name + ' (Shield: ' + battleState.dragon2Shield + ')';
                            }
                            if (shieldInfo) {
                                logMessage += '<p style="color: #8888FF;">' + shieldInfo + '</p>';
                            }
                        }
                        
                        // Update attack summary with result
                        const attackSummary = document.getElementById('attack-summary');
                        if (attackSummary) {
                            if (remainingDamage > 0) {
                                attackSummary.innerHTML = '<p class="damage-message">' + battleState.dragon2.name + ' dealt ' + remainingDamage + ' damage</p>';
                            } else {
                                attackSummary.innerHTML = '<p style="color: #8888FF;">' + battleState.dragon1.name + '\'s shield blocked all damage</p>';
                            }
                        }
                        
                        // Check if battle is over (use newHP1, not battleState which may not be updated yet)
                        if (newHP1 <= 0) {
                            battleLog.innerHTML += logMessage;
                            setTimeout(function() {
                                showWinner();
                            }, 1500);
                            return;
                        }
                    }
                } else {
                    // Draw - no effect, no damage or healing or shields applied
                    // IMPORTANT: Do NOT call updateHealthBar or updateShieldDisplay on draw - HP and shields must remain unchanged
                    logMessage += '<p class="draw-message">It\'s a draw! Both dragons have equal power (' + power1 + ' vs ' + power2 + '). No effect!</p>';
                    logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + battleState.dragon1HP + ' HP | ' + battleState.dragon2.name + ' - ' + battleState.dragon2HP + ' HP</p>';
                    if (battleState.dragon1Shield > 0 || battleState.dragon2Shield > 0) {
                        let shieldInfo = '';
                        if (battleState.dragon1Shield > 0) {
                            shieldInfo += battleState.dragon1.name + ' (Shield: ' + battleState.dragon1Shield + ')';
                        }
                        if (battleState.dragon2Shield > 0) {
                            if (shieldInfo) shieldInfo += ' | ';
                            shieldInfo += battleState.dragon2.name + ' (Shield: ' + battleState.dragon2Shield + ')';
                        }
                        if (shieldInfo) {
                            logMessage += '<p style="color: #8888FF;">' + shieldInfo + '</p>';
                        }
                    }
                    
                    // Update attack summary with result
                    const attackSummary = document.getElementById('attack-summary');
                    if (attackSummary) {
                        attackSummary.innerHTML = '<p class="draw-message" style="font-weight: bold; font-size: 16px;">Tie</p>';
                    }
                }

                // Add HP log for win/loss cases (draw already has it)
                if (logMessage.indexOf('draw') === -1) {
                    // For win/loss, HP and shields are already in logMessage from the win/loss branches
                    // No need to add again
                }
                battleLog.innerHTML += logMessage;

                // Reset for next round - but keep the dropdowns selected
                setTimeout(function() {
                    // Bot automatically selects a new power for the next round
                    botSelectPower();
                    // Re-enable fight button if powers are still selected
                    checkFightButtonState();
                    battleLog.innerHTML += '<p style="color: #88CCFF; font-weight: bold; margin-top: 10px;">Select new powers for the next round (or use the same ones)!</p>';
                    // Keep attack summary visible longer before clearing
                    if (attackSummary) {
                        setTimeout(function() {
                            attackSummary.innerHTML = '<p style="color: #88CCFF; font-weight: bold;">Select new powers and click FIGHT!</p>';
                        }, 5000); // Keep result visible for 5 more seconds (7 seconds total from battle result)
                    }
                }, 2000);
            }, 1500);
        }

        // Create battle message from power description
        function createBattleMessage(dragonName, power) {
            const description = power.description;
            // Extract the action part (usually the first sentence before the dragon name reference)
            // Remove the dragon name and make it about the action
            let action = description;
            
            // Try to extract a meaningful action verb from the description
            // Look for patterns like "can create", "can breathe", etc.
            const actionPatterns = [
                /can (create|breathe|channel|shape|merge|freeze|grow|mix|unleash|store|absorb|transform|summon|focus|surround|lift|spread|hear|detect|combine|release|scatter|travel|call|ring|stomp|raise|sense|produce|surround|manipulate|call down|create localized)/i,
                /(creates|breathes|channels|shapes|merges|freezes|grows|mixes|unleashes|stores|absorbs|transforms|summons|focuses|surrounds|lifts|spreads|hears|detects|combines|releases|scatters|travels|calls|rings|stomps|raises|senses|produces|manipulates)/i
            ];
            
            for (let pattern of actionPatterns) {
                const match = description.match(pattern);
                if (match) {
                    action = match[0];
                    break;
                }
            }
            
            return dragonName + ' ' + action + '!';
        }

        // Determine winner and apply results
        function determineWinner() {
            const battleLog = document.getElementById('battle-log');
            let logMessage = '';

            if (battleState.dragon1HP > battleState.dragon2HP) {
                // Dragon 1 wins - apply difference damage to Dragon 2
                const difference = battleState.dragon1HP - battleState.dragon2HP;
                const newHP2 = battleState.dragon2HP - difference;
                updateHealthBar(2, newHP2);
                
                logMessage += '<p class="result-message">' + battleState.dragon1.name + ' wins this round!</p>';
                logMessage += '<p class="damage-message">' + battleState.dragon2.name + ' takes ' + difference + ' additional damage from the loss!</p>';
                logMessage += '<p>Final HP: ' + battleState.dragon1.name + ' - ' + battleState.dragon1HP + ' HP | ' + battleState.dragon2.name + ' - ' + battleState.dragon2HP + ' HP</p>';
                
                battleLog.innerHTML += logMessage;

                // Check if battle is over
                if (battleState.dragon2HP <= 0) {
                    setTimeout(function() {
                        showWinner();
                    }, 1500);
                } else {
                    // Reset for next round
                    setTimeout(function() {
                        battleState.dragon1Power = null;
                        battleState.dragon2Power = null;
                        document.getElementById('battle-dragon1-powers').value = '';
                        document.getElementById('battle-dragon2-powers').textContent = '-- Bot will select power --';
                        checkFightButtonState();
                        battleLog.innerHTML += '<p style="color: #88CCFF; margin-top: 20px; font-weight: bold;">Select new powers for the next round!</p>';
                    }, 1500);
                }
            } else if (battleState.dragon2HP > battleState.dragon1HP) {
                // Dragon 2 wins - apply difference damage to Dragon 1
                const difference = battleState.dragon2HP - battleState.dragon1HP;
                const newHP1 = battleState.dragon1HP - difference;
                updateHealthBar(1, newHP1);
                
                logMessage += '<p class="result-message">' + battleState.dragon2.name + ' wins this round!</p>';
                logMessage += '<p class="damage-message">' + battleState.dragon1.name + ' takes ' + difference + ' additional damage from the loss!</p>';
                logMessage += '<p>Final HP: ' + battleState.dragon1.name + ' - ' + battleState.dragon1HP + ' HP | ' + battleState.dragon2.name + ' - ' + battleState.dragon2HP + ' HP</p>';
                
                battleLog.innerHTML += logMessage;

                // Check if battle is over
                if (battleState.dragon1HP <= 0) {
                    setTimeout(function() {
                        showWinner();
                    }, 1500);
                } else {
                    // Reset for next round
                    setTimeout(function() {
                        battleState.dragon1Power = null;
                        battleState.dragon2Power = null;
                        document.getElementById('battle-dragon1-powers').value = '';
                        document.getElementById('battle-dragon2-powers').textContent = '-- Bot will select power --';
                        checkFightButtonState();
                        battleLog.innerHTML += '<p style="color: #88CCFF; margin-top: 20px; font-weight: bold;">Select new powers for the next round!</p>';
                    }, 1500);
                }
            } else {
                // Draw
                logMessage += '<p class="draw-message">It\'s a draw! Both dragons remain standing with equal hitpoints.</p>';
                logMessage += '<p>Current HP: ' + battleState.dragon1.name + ' - ' + battleState.dragon1HP + ' HP | ' + battleState.dragon2.name + ' - ' + battleState.dragon2HP + ' HP</p>';
                
                battleLog.innerHTML += logMessage;
                
                // Reset for next round
                setTimeout(function() {
                    battleState.dragon1Power = null;
                    battleState.dragon2Power = null;
                    document.getElementById('battle-dragon1-powers').value = '';
                    document.getElementById('battle-dragon2-powers').textContent = '-- Bot will select power --';
                    checkFightButtonState();
                    battleLog.innerHTML += '<p style="color: #88CCFF; margin-top: 20px; font-weight: bold;">Select new powers for the next round!</p>';
                }, 1500);
            }
        }

        // Show winner screen
        function showWinner() {
            const winnerScreen = document.getElementById('winner-screen');
            const winnerTitle = document.getElementById('winner-title');
            const winnerMessage = document.getElementById('winner-message');

            let winner = null;
            if (battleState.dragon1HP > battleState.dragon2HP) {
                winner = battleState.dragon1;
            } else if (battleState.dragon2HP > battleState.dragon1HP) {
                winner = battleState.dragon2;
            } else {
                winner = null; // Draw
            }

            if (winner) {
                winnerTitle.textContent = 'WINNER!';
                winnerMessage.textContent = winner.name + ' is victorious!';
            } else {
                winnerTitle.textContent = 'DRAW!';
                winnerMessage.textContent = 'Both dragons fought valiantly, but neither could claim victory!';
            }

            winnerScreen.classList.remove('hidden');

            // Set up new game button
            const newGameButton = document.getElementById('new-game-button');
            newGameButton.onclick = function() {
                resetBattle();
            };
        }

        // Function to reset battle and show selection area
        function resetBattle() {
            // Hide battle view and winner screen
            document.getElementById('battle-view').classList.remove('active');
            document.getElementById('winner-screen').classList.add('hidden');
            
            // Show selection area
            document.getElementById('selection-area').classList.remove('hidden');
            
            // Reset selections
            document.getElementById('dragon1-select').value = '';
            document.getElementById('dragon1-display').innerHTML = '';
            
            // Reset battle state
            battleState = {
                dragon1: null,
                dragon2: null,
                dragon1Id: null,
                dragon2Id: null,
                dragon1HP: 10,
                dragon2HP: 10,
                dragon1Shield: 0,
                dragon2Shield: 0,
                dragon1ShieldUses: 0,
                dragon2ShieldUses: 0,
                dragon1InstantHealUsed: false,
                dragon2InstantHealUsed: false,
                dragon1Power: null,
                dragon2Power: null
            };
            
            // Update battle button
            updateBattleButton();
        }
    </script>
</body>
</html>
